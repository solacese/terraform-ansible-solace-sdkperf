# Ansible Inventories, Playbooks & Variables

## Overview

Using the inventory, vars & playbooks either already contained in this folder or generated by Terraform, we are able to execute commands on all the SDKPerf & Solace Broker nodes.

## Highlights

There are 2 subdirectories in this repository:

### [inventory](./inventory) 

This path will be used to store the Ansible Inventory files created by Terraform.


### [playbooks](./playbooks) 

This path already contains Ansible playbooks & variable files, but some other required files will get created by Terraform.

There are 2 folders inside playbooks: 
- [sdkperf](./playbooks/sdkperf) - Here are contained the static playbooks for running the sdkperf commands (ex: stop-sdkperf.yml), and This is also the folder where terraform will generate the Dynamic SDKPerf playbooks 
- [bootstrap](./playbooks/bootstrap) - This folder contains the playbooks, variables & roles required for configuring the SDKPerf & Solace Brokers nodes

> :warning: When using a Solace Broker version either Enterprise or Enterprise Eval, the Docker image must be downloaded and placed on the path "\ansible\playbooks\bootstrap\roles\solace\solace-broker\files" before running Terraform apply.

## Running the SDKPerf sample playbooks

Start the C SDKPerf queue consumers using this command:

`ansible-playbook -i ./ansible/inventory/aws-sa-sdkperf-nodes.inventory --private-key ./keys/aws_key ./ansible/playbooks/sdkperf/aws-sa-start-sdkperf-c-qcons.yml` (AWS Standalone)

`ansible-playbook -i ./ansible/inventory/aws-sa-sdkperf-nodes.inventory --private-key ./keys/aws_key ./ansible/playbooks/sdkperf/aws-sa-start-sdkperf-c-pub.yml` (Azure Standalone)

Start the C SDKPerf queue consumers using this command:

`ansible-playbook -i ./ansible/inventory/az-sa-sdkperf-nodes.inventory --private-key ./keys/azure_key ./ansible/playbooks/sdkperf/az-sa-start-sdkperf-c-qcons.yml` (AWS Standalone)

`ansible-playbook -i ./ansible/inventory/az-sa-sdkperf-nodes.inventory --private-key ./keys/azure_key ./ansible/playbooks/sdkperf/az-sa-start-sdkperf-c-pub.yml` (Azure Standalone)

Stop all consumers & Produces using this command:

`ansible-playbook -i ./ansible/inventory/aws-sa-sdkperf-nodes.inventory --private-key ./keys/aws_key ./ansible/playbooks/sdkperf/stop-sdkperf.yml` (AWS Standalone)

`ansible-playbook -i ./ansible/inventory/az-sa-sdkperf-nodes.inventory --private-key ./keys/azure_key ./ansible/playbooks/sdkperf/stop-sdkperf.yml` (Azure Standalone)

> :information_source: If running the commands while inside the main Repo folder (/)



## Customize SDKPerf Tests

If you want to modify any of the values of the SDKPerf ansibile playbook sample files, you can either modify or create copies of the files:

- start-sdkperf-c-pub.tpl 
- start-sdkperf-c-qcons.tpl

Inside the /terraform/templates/playbooks/ folder

> :warning: If you create copies of the files, make sure to include a Terraform "local_file" resource, to read the new template, parse it and generate the appropriate .yml file on the ansible path